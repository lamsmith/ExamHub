@model ExamHub.ViewModel.ExamsViewModel

@{
    ViewData["Title"] = "Exams";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/css/Student.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>@ViewData["Title"]</title>
</head>
<body>
    <div class="container-fluid">
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="path/to/your/logo.png" alt="Logo" class="logo">
            </div>
            <ul class="sidebar-menu">
                <li><a class="sidebar-link" asp-action="Dashboard" asp-controller="Student"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a class="sidebar-link" asp-action="Exams" asp-controller="Student"><i class="fas fa-book"></i> Exams</a></li>
                <li><a class="sidebar-link" asp-action="ViewGeneralExamResult" asp-controller="Student"><i class="fas fa-chart-bar"></i> Results</a></li>
                <li><a class="sidebar-link" asp-action="Schedule" asp-controller="Student"><i class="fas fa-calendar-alt"></i> Schedule</a></li>
                <li><a class="sidebar-link" asp-action="Profile" asp-controller="Student"><i class="fas fa-user"></i> Profile</a></li>
                <li><a class="sidebar-link" asp-action="Notifications" asp-controller="Student"><i class="fas fa-bell"></i> Notifications</a></li>
                <li><a class="sidebar-link logout" asp-action="Logout" asp-controller="Account"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </div>

        <div class="content">
            <h1 class="mb-4">Today's Exams</h1>
            <div class="section">
                <h2>Available Exams</h2>
                <ul>
                    @foreach (var exam in Model.Exams)
                    {
                        if (exam.StartTime.Date == DateTime.Today)
                        {
                            <li>
                                <strong>@exam.Subject</strong> (@exam.StartTime.ToShortTimeString() - @exam.EndTime.ToShortTimeString())
                                <br />

                                <span class="exam-status" data-start="@exam.StartTime" data-end="@exam.EndTime" data-hastaken="@exam.HasTaken">
                                    
                                </span>
                                <a class="take-exam-link" asp-action="TakeExam" asp-route-examId="@exam.ExamId" asp-controller="Student" style="display:none;">Take Exam</a>
                            </li>
                        }
                    }
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const examStatusElements = document.querySelectorAll(".exam-status");

            examStatusElements.forEach(function (statusElement) {
                const startTime = new Date(statusElement.getAttribute("data-start"));
                const endTime = new Date(statusElement.getAttribute("data-end"));
                const hasTaken = statusElement.getAttribute("data-hastaken") === "True";
                const now = new Date();

                let message = "";
                if (hasTaken) {
                    message = "You have already taken this exam.";
                } else if (now < startTime) {
                    message = `You cannot take the exam before ${startTime.toLocaleTimeString()}.`;
                } else if (now > endTime) {
                    message = `You cannot take the exam after ${endTime.toLocaleTimeString()}.`;
                } else {
                    message = "You can take the exam now.";
                    statusElement.nextElementSibling.style.display = "inline"; // Show the "Take Exam" link
                }

                statusElement.textContent = message;
            });
        });
    </script>
</body>
</html>
